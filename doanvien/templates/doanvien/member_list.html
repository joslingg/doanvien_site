{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Danh s√°ch ƒëo√†n vi√™n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden; /* NgƒÉn cu·ªôn to√†n trang */
        }

        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            z-index: 1000;
            padding: 1rem;
        }

        .scrollable-table {
            position: absolute;
            top: 220px; /* ƒëi·ªÅu ch·ªânh n·∫øu ph·∫ßn header cao h∆°n ho·∫∑c th·∫•p h∆°n */
            left: 0;
            right: 0;
            bottom: 0;
            overflow-y: auto;
            overflow-x: auto;
            padding: 1rem;
            background-color: #f8f9fa;
        }

        thead th {
            position: sticky;
            top: 0;
            background-color: rgb(81, 132, 27) !important;
            color: white !important;
            z-index: 999;
        }

        .scrollable-table tbody tr:first-child td {
            border-top: none !important;
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body class="bg-light">
    <div class="fixed-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2>üìã Danh s√°ch ƒêo√†n vi√™n</h2>
                <div class="d-flex gap-2">
                    <a href="{% url 'add-member' %}" class="btn btn-primary">Th√™m ƒêo√†n vi√™n</a>
                    <a href="{% url 'import-members' %}" class="btn btn-outline-info">‚¨ÜÔ∏è Import</a>
                    <a href="{% url 'export-member-list' %}" class="btn btn-outline-success">‚¨áÔ∏è Xu·∫•t Excel</a>
                    <a href="{% url 'member-stats' %}" class="btn btn-outline-secondary">üìä Th·ªëng k√™</a>
                    <a href="{% url 'logout' %}" class="btn btn-outline-danger">üö™ ƒêƒÉng xu·∫•t</a>
                </div>
            </div>

            <form method="GET" class="mb-3">
                <div class="row mb-2">
                    <div class="col-md-6">
                        <input type="text" name="q" class="form-control" placeholder="T√¨m theo t√™n..." value="{{ search }}">
                    </div>
                    <div class="col-md-6">
                        <select name="department" class="form-select">
                            <option value="">--- Ch·ªçn Khoa/Ph√≤ng ---</option>
                            {% for dept in departments %}
                            <option value="{{ dept.id }}" {% if request.GET.department == dept.id|stringformat:"s" %}selected{% endif %}>
                                {{ dept.name }} 
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="row mb-2">
                    <div class="col-md-6">
                        <select name="group" class="form-select">
                            <option value="">--- Ch·ªçn T·ªï c√¥ng ƒëo√†n ---</option>
                            {% for grp in groups %}
                            <option value="{{ grp.id }}" {% if grp.id|stringformat:"s" == selected_group %}selected{% endif %}>
                                {{ grp.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <select name="status" class="form-select">
                            <option value="">--- Ch·ªçn T√¨nh tr·∫°ng ---</option>
                            {% for stt in statuses %}
                            <option value="{{ stt }}" {% if stt == selected_status %}selected{% endif %}>{{ stt }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <select name="note" class="form-select">
                            <option value="">--- Ch·ªçn Ghi ch√∫ ---</option>
                            {% for n in notes %}
                            <option value="{{ n }}" {% if n == selected_note %}selected{% endif %}>{{ n }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6 text-end">
                        <button class="btn btn-outline-primary w-100">üîç L·ªçc k·∫øt qu·∫£</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="scrollable-table">
        <table class="table table-bordered table-striped table-responsive">
            <thead class="text-center align-middle">
                <tr>
                    <th>STT</th>
                    <th>
                        <a class="text-white text-decoration-none" href="?{% if query_string %}{{ query_string }}&{% endif %}sort=name&direction={% if current_sort == 'name' and current_direction == 'asc' %}desc{% else %}asc{% endif %}">H·ªç t√™n
                            {% if current_sort == 'name' %}
                            <i class="bi {% if current_direction == 'asc' %}bi-caret-up-fill{% else %}bi-caret-down-fill{% endif %} ms-1"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th>
                        <a class="text-white text-decoration-none" href="?{% if query_string %}{{ query_string }}&{% endif %}sort=gender&direction={% if current_sort == 'gender' and current_direction == 'asc' %}desc{% else %}asc{% endif %}">Gi·ªõi t√≠nh
                            {% if current_sort == 'gender' %}
                            <i class="bi {% if current_direction == 'asc' %}bi-caret-up-fill{% else %}bi-caret-down-fill{% endif %} ms-1"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th>
                        <a class="text-white text-decoration-none" href="?{% if query_string %}{{ query_string }}&{% endif %}sort=department__name&direction={% if current_sort == 'department__name' and current_direction == 'asc' %}desc{% else %}asc{% endif %}">Khoa/Ph√≤ng
                            {% if current_sort == 'department__name' %}
                            <i class="bi {% if current_direction == 'asc' %}bi-caret-up-fill{% else %}bi-caret-down-fill{% endif %} ms-1"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th>
                        <a class="text-white text-decoration-none" href="?{% if query_string %}{{ query_string }}&{% endif %}sort=group__name&direction={% if current_sort == 'group__name' and current_direction == 'asc' %}desc{% else %}asc{% endif %}">T·ªï
                            {% if current_sort == 'group__name' %}
                            <i class="bi {% if current_direction == 'asc' %}bi-caret-up-fill{% else %}bi-caret-down-fill{% endif %} ms-1"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th>
                        <a class="text-white text-decoration-none" href="?{% if query_string %}{{ query_string }}&{% endif %}sort=status&direction={% if current_sort == 'status' and current_direction == 'asc' %}desc{% else %}asc{% endif %}">T√¨nh tr·∫°ng
                            {% if current_sort == 'status' %}
                            <i class="bi {% if current_direction == 'asc' %}bi-caret-up-fill{% else %}bi-caret-down-fill{% endif %} ms-1"></i>
                            {% endif %}
                        </a>
                    </th>
                    <th>
                        Ghi ch√∫
                    </th>

                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody class='text-center align-middle'>
                {% for member in members %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td class='text-start align-middle'>{{ member.name }}</td>
                    <td>{{ member.gender }}</td>
                    <td>{{ member.department.name }}</td>
                    <td>{{ member.group.name }}</td>
                    <td>{{ member.status }}</td>
                    <td>{{ member.note|default:"" }}</td>
                    <td>
                        <a href="{% url 'edit-member' member.id %}" class="btn btn-sm btn-warning">S·ª≠a</a>
                        <a href="{% url 'delete-member' member.id %}" class="btn btn-sm btn-danger">X√≥a</a>
                    </td>    
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8">Kh√¥ng t√¨m th·∫•y ƒëo√†n vi√™n n√†o.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>
